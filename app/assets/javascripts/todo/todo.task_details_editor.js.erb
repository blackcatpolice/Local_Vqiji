;(function($) {
  "use strict";
  
  $.widget("todo.todoTaskDetailsEditor", $.rtext.rtextEditor, {
    options: {
    	allowBlank: false,
    	placeHolder: "请输入任务描述",
    	tools: ['picture', 'file']
    },

    _submit: function (_, done) {
      this._setAttachmentIds();
      
      this._trigger("submit");
      done();

      return false;
    },

    _setAttachmentIds: function() {
      this.element.find("input.todo-task-log-picture-id").val( this._picture ? this._picture.id : null );
      var _fileId = null;
      if (this._file || this._selectedFile) {
        _fileId = (this._file || this._selectedFile).id;
      }
      this.element.find("input.todo-task-log-file-id").val( _fileId );
    }
  });
})( jQuery );
